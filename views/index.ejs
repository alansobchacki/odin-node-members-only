<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title></title>
  </head>
  <body>
    <div id="index-main-container">
      <div id="login-form">
        <% if (user) { %>
        <h1>Welcome, <%= user.username %></h1>

        <% if (user.membership_id === 1) { %>

        <p>Thank you for signing up!</p>
        <p>
          You're now an initiate member. You're still not allowed to write
          messages, or see who wrote what.
        </p>
        <p>To increase your membership level, you have to prove your worth.</p>
        <a href="/riddle">Click here to prove you're a worthy member</a>

        <p>Click <a href="/log-out">here</a> to logout.</p>
        <% } else if (user.membership_id >= 2) { %>

        <p>Want to leave a message?</p>

        <form action="/" method="POST">
          <input type="hidden" name="username" value="<%= user.username %>" />

          <label for="message">Your message here</label>
          <input
            id="message"
            name="message"
            placeholder="Your message here..."
            type="text"
          />
          <button>Send Message</button>
        </form>

        <p>Click <a href="/log-out">here</a> to logout.</p>
        <% } %> <% } else { %>

        <h1>Please log in</h1>

        <form action="/log-in" method="POST">
          <label for="username">Username</label>
          <input
            id="username"
            name="username"
            placeholder="username"
            type="text"
          />
          <label for="password">Password</label>
          <input id="password" name="password" type="password" />
          <button>Log In</button>
        </form>

        <p>Don't have an account?</p>
        <a href="/sign-up">Create one</a>
        <% } %>
      </div>

      <div id="messages">
        <% messages.forEach(function(message) { %>
        <div class="message-box">
          <p><%= message.content %></p>
          <% if (user && user.membership_id >= 2) { %>
          <p>posted by <%= message.username %> on <%= message.created_at %></p>
          <% } else { %>
          <p>posted by ? on</p>
          <% } %> <% if (user && user.membership_id === 3) { %>
          <form
            action="/messages/<%= message.id %>?_method=DELETE"
            method="POST"
            style="display: inline"
          >
            <button
              type="submit"
              style="border: none; background: none; cursor: pointer"
            >
              üóëÔ∏è
            </button>
          </form>
          <% } %>
        </div>
        <% }); %>
      </div>
    </div>
  </body>
</html>
